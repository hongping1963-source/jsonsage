"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7318],{2646:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"examples/basic/file-monitoring","title":"JSON\u6587\u4ef6\u76d1\u63a7\u793a\u4f8b","description":"\u672c\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u4f7f\u7528JsonSage\u76d1\u63a7JSON\u6587\u4ef6\u7684\u53d8\u5316\u3002","source":"@site/docs/examples/basic/file-monitoring.md","sourceDirName":"examples/basic","slug":"/examples/basic/file-monitoring","permalink":"/jsonsage/examples/basic/file-monitoring","draft":false,"unlisted":false,"editUrl":"https://github.com/hongping1963-source/jsonsage/tree/main/website/docs/examples/basic/file-monitoring.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"date":"2025-01-14T00:00:00.000Z","last_update":{"date":"2025-01-14T00:00:00.000Z"}},"sidebar":"tutorialSidebar","previous":{"title":"API \u53c2\u8003\u6587\u6863","permalink":"/jsonsage/api/reference"},"next":{"title":"JSON\u6570\u636e\u9a8c\u8bc1\u793a\u4f8b","permalink":"/jsonsage/examples/basic/validation"}}');var t=r(74848),a=r(28453);const o={sidebar_position:1,date:new Date("2025-01-14T00:00:00.000Z"),last_update:{date:new Date("2025-01-14T00:00:00.000Z")}},i="JSON\u6587\u4ef6\u76d1\u63a7\u793a\u4f8b",l={},c=[{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:2},{value:"\u9ad8\u7ea7\u914d\u7f6e",id:"\u9ad8\u7ea7\u914d\u7f6e",level:2},{value:"\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668",id:"\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668",level:3},{value:"\u6279\u91cf\u5904\u7406",id:"\u6279\u91cf\u5904\u7406",level:3},{value:"\u5b9e\u65f6\u793a\u4f8b",id:"\u5b9e\u65f6\u793a\u4f8b",level:2},{value:"\u76d1\u63a7\u914d\u7f6e\u6587\u4ef6",id:"\u76d1\u63a7\u914d\u7f6e\u6587\u4ef6",level:3},{value:"\u76d1\u63a7\u591a\u4e2a\u76ee\u5f55",id:"\u76d1\u63a7\u591a\u4e2a\u76ee\u5f55",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"\u5b8c\u6574\u793a\u4f8b",id:"\u5b8c\u6574\u793a\u4f8b",level:2},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:2}];function d(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"json\u6587\u4ef6\u76d1\u63a7\u793a\u4f8b",children:"JSON\u6587\u4ef6\u76d1\u63a7\u793a\u4f8b"})}),"\n",(0,t.jsx)(e.p,{children:"\u672c\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u4f7f\u7528JsonSage\u76d1\u63a7JSON\u6587\u4ef6\u7684\u53d8\u5316\u3002"}),"\n",(0,t.jsx)(e.h2,{id:"\u57fa\u672c\u7528\u6cd5",children:"\u57fa\u672c\u7528\u6cd5"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"import { JsonSage } from '@zhanghongping/json-sage-workflow';\r\n\r\n// \u521b\u5efaJsonSage\u5b9e\u4f8b\r\nconst sage = new JsonSage({\r\n  watchPath: './data',  // \u76d1\u63a7\u7684\u76ee\u5f55\r\n  patterns: ['**/*.json'],  // \u5339\u914d\u7684\u6587\u4ef6\u6a21\u5f0f\r\n  exclude: ['**/node_modules/**']  // \u6392\u9664\u7684\u6587\u4ef6\r\n});\r\n\r\n// \u76d1\u542c\u6587\u4ef6\u53d8\u5316\u4e8b\u4ef6\r\nsage.on('fileChange', (event) => {\r\n  console.log(`\u6587\u4ef6 ${event.path} \u53d1\u751f\u53d8\u5316`);\r\n  console.log('\u53d8\u5316\u7c7b\u578b:', event.type);  // 'add' | 'change' | 'unlink'\r\n  console.log('\u53d8\u5316\u65f6\u95f4:', event.timestamp);\r\n});\r\n\r\n// \u542f\u52a8\u76d1\u63a7\r\nsage.start();\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u9ad8\u7ea7\u914d\u7f6e",children:"\u9ad8\u7ea7\u914d\u7f6e"}),"\n",(0,t.jsx)(e.h3,{id:"\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668",children:"\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u5668"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"const sage = new JsonSage({\r\n  watchPath: './data',\r\n  filter: (filePath) => {\r\n    // \u53ea\u76d1\u63a7\u5927\u5c0f\u5c0f\u4e8e1MB\u7684\u6587\u4ef6\r\n    const stats = fs.statSync(filePath);\r\n    return stats.size < 1024 * 1024;\r\n  }\r\n});\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u6279\u91cf\u5904\u7406",children:"\u6279\u91cf\u5904\u7406"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"sage.on('fileChange', async (event) => {\r\n  if (event.type === 'change') {\r\n    // \u6279\u91cf\u5904\u7406\u53d8\u5316\u7684\u6587\u4ef6\r\n    const files = await sage.getChangedFiles();\r\n    for (const file of files) {\r\n      const content = await fs.promises.readFile(file, 'utf-8');\r\n      // \u5904\u7406\u6587\u4ef6\u5185\u5bb9\r\n      await processJsonContent(content);\r\n    }\r\n  }\r\n});\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u5b9e\u65f6\u793a\u4f8b",children:"\u5b9e\u65f6\u793a\u4f8b"}),"\n",(0,t.jsx)(e.h3,{id:"\u76d1\u63a7\u914d\u7f6e\u6587\u4ef6",children:"\u76d1\u63a7\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"// \u76d1\u63a7\u914d\u7f6e\u6587\u4ef6\u53d8\u5316\r\nconst configSage = new JsonSage({\r\n  watchPath: './config',\r\n  patterns: ['config.json'],\r\n  debounceTime: 1000  // \u9632\u6296\u65f6\u95f4\r\n});\r\n\r\nconfigSage.on('fileChange', async (event) => {\r\n  if (event.type === 'change') {\r\n    try {\r\n      // \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\r\n      const config = await loadConfig(event.path);\r\n      // \u5e94\u7528\u65b0\u914d\u7f6e\r\n      await applyNewConfig(config);\r\n    } catch (error) {\r\n      console.error('\u914d\u7f6e\u66f4\u65b0\u5931\u8d25:', error);\r\n    }\r\n  }\r\n});\n"})}),"\n",(0,t.jsx)(e.h3,{id:"\u76d1\u63a7\u591a\u4e2a\u76ee\u5f55",children:"\u76d1\u63a7\u591a\u4e2a\u76ee\u5f55"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"const multiSage = new JsonSage({\r\n  watchPaths: ['./data', './config', './temp'],\r\n  patterns: {\r\n    './data': ['**/*.json'],\r\n    './config': ['*.json'],\r\n    './temp': ['temp-*.json']\r\n  }\r\n});\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,t.jsx)(e.code,{children:"debounceTime"})," \u63a7\u5236\u4e8b\u4ef6\u89e6\u53d1\u9891\u7387"]}),"\n",(0,t.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,t.jsx)(e.code,{children:"filter"})," \u8fc7\u6ee4\u4e0d\u9700\u8981\u5904\u7406\u7684\u6587\u4ef6"]}),"\n",(0,t.jsx)(e.li,{children:"\u4f7f\u7528\u6279\u91cf\u5904\u7406\u51cf\u5c11IO\u64cd\u4f5c"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"\u5b8c\u6574\u793a\u4f8b",children:"\u5b8c\u6574\u793a\u4f8b"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-typescript",children:"import { JsonSage } from '@zhanghongping/json-sage-workflow';\r\nimport * as fs from 'fs';\r\nimport * as path from 'path';\r\n\r\nasync function setupJsonMonitoring() {\r\n  const sage = new JsonSage({\r\n    watchPath: './data',\r\n    patterns: ['**/*.json'],\r\n    exclude: ['**/node_modules/**', '**/.*'],\r\n    debounceTime: 1000,\r\n    filter: (filePath) => {\r\n      const stats = fs.statSync(filePath);\r\n      return stats.size < 1024 * 1024;\r\n    }\r\n  });\r\n\r\n  sage.on('fileChange', async (event) => {\r\n    console.log(`\u68c0\u6d4b\u5230\u6587\u4ef6\u53d8\u5316: ${event.path}`);\r\n\r\n    try {\r\n      const content = await fs.promises.readFile(event.path, 'utf-8');\r\n      const json = JSON.parse(content);\r\n\r\n      switch (event.type) {\r\n        case 'add':\r\n          console.log('\u65b0\u6587\u4ef6\u5df2\u6dfb\u52a0');\r\n          await processNewFile(json);\r\n          break;\r\n        case 'change':\r\n          console.log('\u6587\u4ef6\u5df2\u4fee\u6539');\r\n          await processChangedFile(json);\r\n          break;\r\n        case 'unlink':\r\n          console.log('\u6587\u4ef6\u5df2\u5220\u9664');\r\n          await handleDeletedFile(event.path);\r\n          break;\r\n      }\r\n    } catch (error) {\r\n      console.error('\u5904\u7406\u6587\u4ef6\u65f6\u51fa\u9519:', error);\r\n    }\r\n  });\r\n\r\n  // \u542f\u52a8\u76d1\u63a7\r\n  await sage.start();\r\n  console.log('\u6587\u4ef6\u76d1\u63a7\u5df2\u542f\u52a8');\r\n\r\n  // \u9519\u8bef\u5904\u7406\r\n  sage.on('error', (error) => {\r\n    console.error('\u76d1\u63a7\u9519\u8bef:', error);\r\n  });\r\n\r\n  return sage;\r\n}\r\n\r\n// \u4f7f\u7528\u793a\u4f8b\r\nsetupJsonMonitoring()\r\n  .then(sage => {\r\n    console.log('\u76d1\u63a7\u7cfb\u7edf\u5df2\u5c31\u7eea');\r\n  })\r\n  .catch(error => {\r\n    console.error('\u542f\u52a8\u76d1\u63a7\u5931\u8d25:', error);\r\n  });\n"})}),"\n",(0,t.jsx)(e.h2,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\u5408\u7406\u8bbe\u7f6e ",(0,t.jsx)(e.code,{children:"debounceTime"})," \u907f\u514d\u9891\u7e41\u89e6\u53d1"]}),"\n",(0,t.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,t.jsx)(e.code,{children:"exclude"})," \u6392\u9664\u4e0d\u9700\u8981\u76d1\u63a7\u7684\u6587\u4ef6"]}),"\n",(0,t.jsx)(e.li,{children:"\u6dfb\u52a0\u9519\u8bef\u5904\u7406\u786e\u4fdd\u7cfb\u7edf\u7a33\u5b9a\u6027"}),"\n",(0,t.jsx)(e.li,{children:"\u8003\u8651\u6587\u4ef6\u5927\u5c0f\u9650\u5236\u907f\u514d\u5185\u5b58\u95ee\u9898"}),"\n",(0,t.jsx)(e.li,{children:"\u4f7f\u7528\u5f02\u6b65\u64cd\u4f5c\u5904\u7406\u6587\u4ef6\u5185\u5bb9"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},28453:(n,e,r)=>{r.d(e,{R:()=>o,x:()=>i});var s=r(96540);const t={},a=s.createContext(t);function o(n){const e=s.useContext(a);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:o(n.components),s.createElement(a.Provider,{value:e},n.children)}}}]);