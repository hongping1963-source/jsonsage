"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[850],{35439:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"examples/basic/transformation","title":"JSON\u6570\u636e\u8f6c\u6362\u793a\u4f8b","description":"\u672c\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u4f7f\u7528JsonSage\u8fdb\u884cJSON\u6570\u636e\u8f6c\u6362\u3002","source":"@site/docs/examples/basic/transformation.md","sourceDirName":"examples/basic","slug":"/examples/basic/transformation","permalink":"/jsonsage/examples/basic/transformation","draft":false,"unlisted":false,"editUrl":"https://github.com/hongping1963-source/jsonsage/tree/main/website/docs/examples/basic/transformation.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"JSON\u6570\u636e\u9a8c\u8bc1\u793a\u4f8b","permalink":"/jsonsage/examples/basic/validation"},"next":{"title":"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\u89c4\u5219\u793a\u4f8b","permalink":"/jsonsage/examples/advanced/custom-validation"}}');var a=e(74848),t=e(28453);const l={},i="JSON\u6570\u636e\u8f6c\u6362\u793a\u4f8b",o={},d=[{value:"\u57fa\u7840\u8f6c\u6362",id:"\u57fa\u7840\u8f6c\u6362",level:2},{value:"\u7b80\u5355\u5b57\u6bb5\u6620\u5c04",id:"\u7b80\u5355\u5b57\u6bb5\u6620\u5c04",level:3},{value:"\u6570\u636e\u7c7b\u578b\u8f6c\u6362",id:"\u6570\u636e\u7c7b\u578b\u8f6c\u6362",level:3},{value:"\u9ad8\u7ea7\u8f6c\u6362",id:"\u9ad8\u7ea7\u8f6c\u6362",level:2},{value:"\u81ea\u5b9a\u4e49\u8f6c\u6362\u51fd\u6570",id:"\u81ea\u5b9a\u4e49\u8f6c\u6362\u51fd\u6570",level:3},{value:"\u6761\u4ef6\u8f6c\u6362",id:"\u6761\u4ef6\u8f6c\u6362",level:3},{value:"\u6279\u91cf\u8f6c\u6362",id:"\u6279\u91cf\u8f6c\u6362",level:2},{value:"\u5b9e\u65f6\u8f6c\u6362",id:"\u5b9e\u65f6\u8f6c\u6362",level:2},{value:"\u5b8c\u6574\u793a\u4f8b",id:"\u5b8c\u6574\u793a\u4f8b",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2}];function c(n){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"json\u6570\u636e\u8f6c\u6362\u793a\u4f8b",children:"JSON\u6570\u636e\u8f6c\u6362\u793a\u4f8b"})}),"\n",(0,a.jsx)(r.p,{children:"\u672c\u793a\u4f8b\u5c55\u793a\u5982\u4f55\u4f7f\u7528JsonSage\u8fdb\u884cJSON\u6570\u636e\u8f6c\u6362\u3002"}),"\n",(0,a.jsx)(r.h2,{id:"\u57fa\u7840\u8f6c\u6362",children:"\u57fa\u7840\u8f6c\u6362"}),"\n",(0,a.jsx)(r.h3,{id:"\u7b80\u5355\u5b57\u6bb5\u6620\u5c04",children:"\u7b80\u5355\u5b57\u6bb5\u6620\u5c04"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-typescript",children:"import { JsonSage } from '@zhanghongping/json-sage-workflow';\r\n\r\nconst transformer = new JsonSage();\r\n\r\nconst mappingRule = {\r\n  'name': 'userName',\r\n  'age': 'userAge',\r\n  'address.city': 'userCity'\r\n};\r\n\r\nconst result = await transformer.transform('./input.json', mappingRule);\n"})}),"\n",(0,a.jsx)(r.h3,{id:"\u6570\u636e\u7c7b\u578b\u8f6c\u6362",children:"\u6570\u636e\u7c7b\u578b\u8f6c\u6362"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-typescript",children:"const typeRule = {\r\n  'age': (value) => Number(value),\r\n  'isActive': (value) => Boolean(value),\r\n  'scores': (value) => Array.isArray(value) ? value : [value]\r\n};\r\n\r\nconst result = await transformer.transform('./data.json', typeRule);\n"})}),"\n",(0,a.jsx)(r.h2,{id:"\u9ad8\u7ea7\u8f6c\u6362",children:"\u9ad8\u7ea7\u8f6c\u6362"}),"\n",(0,a.jsx)(r.h3,{id:"\u81ea\u5b9a\u4e49\u8f6c\u6362\u51fd\u6570",children:"\u81ea\u5b9a\u4e49\u8f6c\u6362\u51fd\u6570"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-typescript",children:"const customRule = {\r\n  'fullName': (data) => `${data.firstName} ${data.lastName}`,\r\n  'age': (value) => ({\r\n    years: Number(value),\r\n    isAdult: Number(value) >= 18\r\n  }),\r\n  'contacts': (data) => ({\r\n    email: data.email,\r\n    phone: formatPhoneNumber(data.phone)\r\n  })\r\n};\n"})}),"\n",(0,a.jsx)(r.h3,{id:"\u6761\u4ef6\u8f6c\u6362",children:"\u6761\u4ef6\u8f6c\u6362"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-typescript",children:"const conditionalRule = {\r\n  'type': (value, data) => {\r\n    if (data.age < 18) return 'junior';\r\n    if (data.age < 60) return 'adult';\r\n    return 'senior';\r\n  },\r\n  'discount': (value, data) => {\r\n    switch (data.memberType) {\r\n      case 'gold': return 0.8;\r\n      case 'silver': return 0.9;\r\n      default: return 1;\r\n    }\r\n  }\r\n};\n"})}),"\n",(0,a.jsx)(r.h2,{id:"\u6279\u91cf\u8f6c\u6362",children:"\u6279\u91cf\u8f6c\u6362"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-typescript",children:"async function transformMultipleFiles() {\r\n  const transformer = new JsonSage();\r\n  \r\n  const results = await transformer.transformBatch({\r\n    './users/*.json': userTransformRule,\r\n    './orders/*.json': orderTransformRule\r\n  });\r\n\r\n  for (const [file, result] of Object.entries(results)) {\r\n    if (result.success) {\r\n      await saveTransformedFile(file, result.data);\r\n    }\r\n  }\r\n}\n"})}),"\n",(0,a.jsx)(r.h2,{id:"\u5b9e\u65f6\u8f6c\u6362",children:"\u5b9e\u65f6\u8f6c\u6362"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-typescript",children:"const sage = new JsonSage({\r\n  watchPath: './data',\r\n  transformOnChange: true,\r\n  transformRules: {\r\n    'users/*.json': userTransformRule,\r\n    'orders/*.json': orderTransformRule\r\n  }\r\n});\r\n\r\nsage.on('transformComplete', (result) => {\r\n  console.log(`\u6587\u4ef6 ${result.file} \u8f6c\u6362\u5b8c\u6210`);\r\n});\r\n\r\nsage.start();\n"})}),"\n",(0,a.jsx)(r.h2,{id:"\u5b8c\u6574\u793a\u4f8b",children:"\u5b8c\u6574\u793a\u4f8b"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-typescript",children:"import { JsonSage } from '@zhanghongping/json-sage-workflow';\r\nimport * as fs from 'fs';\r\nimport * as path from 'path';\r\n\r\nasync function setupTransformation() {\r\n  // \u521b\u5efa\u8f6c\u6362\u5668\u5b9e\u4f8b\r\n  const sage = new JsonSage({\r\n    watchPath: './data',\r\n    transformOnChange: true\r\n  });\r\n\r\n  // \u5b9a\u4e49\u7528\u6237\u6570\u636e\u8f6c\u6362\u89c4\u5219\r\n  const userTransformRule = {\r\n    // \u57fa\u672c\u5b57\u6bb5\u6620\u5c04\r\n    'id': 'userId',\r\n    'name': (data) => ({\r\n      firstName: data.name.split(' ')[0],\r\n      lastName: data.name.split(' ')[1]\r\n    }),\r\n    \r\n    // \u5730\u5740\u8f6c\u6362\r\n    'address': (data) => ({\r\n      street: data.address.street,\r\n      city: data.address.city,\r\n      country: data.address.country,\r\n      formatted: `${data.address.street}, ${data.address.city}, ${data.address.country}`\r\n    }),\r\n    \r\n    // \u8054\u7cfb\u65b9\u5f0f\u8f6c\u6362\r\n    'contacts': (data) => ({\r\n      email: data.email.toLowerCase(),\r\n      phone: formatPhoneNumber(data.phone),\r\n      hasEmail: Boolean(data.email),\r\n      hasPhone: Boolean(data.phone)\r\n    }),\r\n    \r\n    // \u8ba1\u7b97\u5b57\u6bb5\r\n    'age': (value) => ({\r\n      years: Number(value),\r\n      isAdult: Number(value) >= 18,\r\n      ageGroup: getAgeGroup(Number(value))\r\n    }),\r\n    \r\n    // \u72b6\u6001\u8f6c\u6362\r\n    'status': (value, data) => ({\r\n      current: value,\r\n      isActive: value === 'active',\r\n      lastUpdated: new Date().toISOString()\r\n    })\r\n  };\r\n\r\n  // \u8bbe\u7f6e\u8f6c\u6362\u89c4\u5219\r\n  sage.setTransformRules({\r\n    'users/*.json': userTransformRule\r\n  });\r\n\r\n  // \u76d1\u542c\u8f6c\u6362\u4e8b\u4ef6\r\n  sage.on('transformError', (error) => {\r\n    console.error(`\u6587\u4ef6 ${error.file} \u8f6c\u6362\u5931\u8d25:`, error.message);\r\n    notifyTransformError(error);\r\n  });\r\n\r\n  sage.on('transformComplete', (result) => {\r\n    console.log(`\u6587\u4ef6 ${result.file} \u8f6c\u6362\u5b8c\u6210`);\r\n    saveTransformedFile(result.file, result.data);\r\n  });\r\n\r\n  // \u542f\u52a8\u76d1\u63a7\u548c\u8f6c\u6362\r\n  await sage.start();\r\n\r\n  return sage;\r\n}\r\n\r\n// \u8f85\u52a9\u51fd\u6570\r\nfunction formatPhoneNumber(phone) {\r\n  // \u683c\u5f0f\u5316\u7535\u8bdd\u53f7\u7801\r\n  return phone.replace(/(\\d{3})(\\d{4})(\\d{4})/, '$1-$2-$3');\r\n}\r\n\r\nfunction getAgeGroup(age) {\r\n  if (age < 18) return 'junior';\r\n  if (age < 30) return 'young';\r\n  if (age < 50) return 'middle';\r\n  return 'senior';\r\n}\r\n\r\n// \u4f7f\u7528\u793a\u4f8b\r\nconst inputData = {\r\n  id: '001',\r\n  name: 'Zhang San',\r\n  age: 30,\r\n  email: 'ZHANGSAN@EXAMPLE.COM',\r\n  phone: '13912345678',\r\n  address: {\r\n    street: '\u4e2d\u5173\u6751\u5927\u88571\u53f7',\r\n    city: '\u5317\u4eac',\r\n    country: '\u4e2d\u56fd'\r\n  },\r\n  status: 'active'\r\n};\r\n\r\n// \u8f6c\u6362\u5355\u4e2a\u6570\u636e\r\nconst sage = new JsonSage();\r\nconst result = await sage.transformData(inputData, userTransformRule);\r\n\r\nif (result.success) {\r\n  console.log('\u6570\u636e\u8f6c\u6362\u6210\u529f:', result.data);\r\n  await fs.promises.writeFile(\r\n    './data/transformed/user_001.json',\r\n    JSON.stringify(result.data, null, 2)\r\n  );\r\n} else {\r\n  console.error('\u6570\u636e\u8f6c\u6362\u5931\u8d25:', result.error);\r\n}\n"})}),"\n",(0,a.jsx)(r.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,a.jsxs)(r.ol,{children:["\n",(0,a.jsxs)(r.li,{children:["\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"\u89c4\u5219\u6a21\u5757\u5316"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"\u5c06\u8f6c\u6362\u89c4\u5219\u5206\u6a21\u5757\u7ba1\u7406"}),"\n",(0,a.jsx)(r.li,{children:"\u521b\u5efa\u53ef\u91cd\u7528\u7684\u8f6c\u6362\u51fd\u6570"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"\u6570\u636e\u9a8c\u8bc1"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"\u8f6c\u6362\u524d\u9a8c\u8bc1\u8f93\u5165\u6570\u636e"}),"\n",(0,a.jsx)(r.li,{children:"\u8f6c\u6362\u540e\u9a8c\u8bc1\u8f93\u51fa\u6570\u636e"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"\u9519\u8bef\u5904\u7406"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"\u5b9e\u73b0\u4f18\u96c5\u7684\u9519\u8bef\u5904\u7406"}),"\n",(0,a.jsx)(r.li,{children:"\u63d0\u4f9b\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"\u6027\u80fd\u4f18\u5316"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"\u4f7f\u7528\u7f13\u5b58\u907f\u514d\u91cd\u590d\u8f6c\u6362"}),"\n",(0,a.jsx)(r.li,{children:"\u5b9e\u73b0\u589e\u91cf\u8f6c\u6362"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"\u53ef\u7ef4\u62a4\u6027"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"\u4e3a\u590d\u6742\u8f6c\u6362\u6dfb\u52a0\u6ce8\u91ca"}),"\n",(0,a.jsx)(r.li,{children:"\u4f7f\u7528\u7c7b\u578b\u5b9a\u4e49\u63d0\u9ad8\u4ee3\u7801\u8d28\u91cf"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(r.li,{children:["\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.strong,{children:"\u6d4b\u8bd5"})}),"\n",(0,a.jsxs)(r.ul,{children:["\n",(0,a.jsx)(r.li,{children:"\u4e3a\u6bcf\u4e2a\u8f6c\u6362\u89c4\u5219\u7f16\u5199\u5355\u5143\u6d4b\u8bd5"}),"\n",(0,a.jsx)(r.li,{children:"\u8fdb\u884c\u8fb9\u754c\u6761\u4ef6\u6d4b\u8bd5"}),"\n"]}),"\n"]}),"\n"]})]})}function u(n={}){const{wrapper:r}={...(0,t.R)(),...n.components};return r?(0,a.jsx)(r,{...n,children:(0,a.jsx)(c,{...n})}):c(n)}},28453:(n,r,e)=>{e.d(r,{R:()=>l,x:()=>i});var s=e(96540);const a={},t=s.createContext(a);function l(n){const r=s.useContext(t);return s.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function i(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:l(n.components),s.createElement(t.Provider,{value:r},n.children)}}}]);